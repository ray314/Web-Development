<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <!-- Popper JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

        <title>Booking Page</title>
    </head>

    <body>
        <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
            <a class="navbar-brand" href="#">CabsOnline</a>
        </nav>
        

        <!-- Inputs: customer name, contact phone, pick-up
address (unit number if applicable, street number, street name, and suburb), destination suburb,
and pick-up date/time. 
        Booking reference number generated from MySQL -->
        <div class="container">
            <h1>Booking</h1>
            <form id="booking">
                <div class="form-group">
                    <label for="name">Name:</label>
                    <input type="text" class="form-control" id="name" required>

                    <label for="phone">Phone:</label>
                    <input type="text" class="form-control" id="phone" required>

                    <label for="pickup-address">Pick-up address:</label>
                    <input type="text" class="form-control" id="pickup-address" required>

                    <label for="destination-suburb">Destination suburb:</label>
                    <input type="text" class="form-control" id="destination-suburb" required>

                    <label for="date-time">Pick-up date and time:</label>
                    <input type="datetime-local" class="form-control" id="date-time" min="2000-01-01" required>

                    <input type="submit" class="btn btn-primary mt-2">
                </div>
            </form>
            <br>
            <span id="status"></span>
        </div>

        <script>
            // Set the minimum date to today
            var today = new Date();
            var yyyy = today.getFullYear();
            var mm = today.getMonth()+1;
            var dd = today.getDate();
            var hh = today.getHours();
            var m = today.getMinutes();
            // Add a 0 before the 2nd digit.
            if(dd<10){ // Day
                dd='0'+dd
            } 
            if(mm<10){ // Month
                mm='0'+mm
            } 
            if(hh<10){ // Hour
                hh='0'+hh
            } 
            if(m<10){ // Minute
                m='0'+m
            } 
            today = yyyy+'-'+mm+'-'+dd+'T'+hh+':'+m; // eg. 2018-06-12T19:30 
            console.log(today);
            document.getElementById("date-time").setAttribute("min", today);

            function submit(e) {
                e.preventDefault();

                var xhttp = new XMLHttpRequest();
                var name = document.getElementById("name").value();
                var phone = document.getElementById("phone").value();
                var pickup_address = document.getElementById("pickup-address").value();
                var destination_suburb = document.getElementById("destination-suburb").value();
                var date_time = document.getElementById("date-time").value();

                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        document.getElementById("status").innerHTML = this.responseText;
                    }
                };
                xhttp.open("POST", "book_process.php", true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send("name="+name+"&phone="+phone+"&pickup="+
                pickup_address+"&dest="+destination_suburb+"&datetime="+date_time);

            }

            var form = document.getElementById("booking");
            form.addEventListener('submit', submit);
        </script>
    </body>
</html>